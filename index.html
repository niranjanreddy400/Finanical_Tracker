<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Financial Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #6366F1 0%, #EC4899 100%);
        }
        .bg-gray-800 {
            background: linear-gradient(135deg, #1e293b 60%, #6366F1 100%);
        }
        .bg-gray-900 {
            background: linear-gradient(135deg, #0f172a 60%, #EC4899 100%);
        }
        .tab-button {
            transition: all 0.3s ease;
            background: linear-gradient(90deg, #6366F1 0%, #EC4899 100%);
            color: #fff;
            margin-right: 0.5rem;
            box-shadow: 0 2px 8px rgba(99,102,241,0.15);
        }
        .tab-button.active {
            border-bottom: 3px solid #EC4899;
            color: #EC4899;
            font-weight: 700;
            background: #fff;
        }
        .rounded-2xl, .rounded-xl, .rounded-lg {
            border-radius: 1.5rem !important;
        }
        .shadow-lg, .shadow {
            box-shadow: 0 8px 32px rgba(236,72,153,0.15), 0 1.5px 8px rgba(99,102,241,0.10);
        }
        .card {
            background: linear-gradient(135deg, #fff 60%, #6366F1 100%);
            color: #1e293b;
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px rgba(236,72,153,0.15);
            padding: 2rem;
            margin-bottom: 1rem;
        }
        .btn-primary {
            background: linear-gradient(90deg, #6366F1 0%, #EC4899 100%);
            color: #fff;
            font-weight: 600;
            border-radius: 1rem;
            box-shadow: 0 2px 8px rgba(99,102,241,0.15);
            transition: background 0.3s;
        }
        .btn-primary:hover {
            background: linear-gradient(90deg, #EC4899 0%, #6366F1 100%);
        }
        .text-indigo-500 {
            color: #EC4899 !important;
        }
        .text-3xl {
            color: #6366F1;
        }
        .modal {
            background: linear-gradient(135deg, #fff 60%, #EC4899 100%);
            color: #1e293b;
            border-radius: 1.5rem;
        }
        /* Add more custom styles for tables, forms, etc. as needed */
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-indigo-500"></div>
    </div>

    <!-- Login Page -->
    <div id="login-container" class="bg-gray-800 p-8 rounded-2xl shadow-lg w-full max-w-sm hidden">
        <h2 class="text-3xl font-bold text-center mb-6 text-indigo-500">Login</h2>
        <p class="text-center text-gray-400 mb-6">Sign in to access your dashboard</p>
        <div class="space-y-4">
            <button id="login-btn" class="btn-primary w-full py-3 px-6">
                Sign in Anonymously
            </button>
        </div>
        <p class="text-center text-gray-500 text-sm mt-4">No password needed. Your data is tied to this device.</p>
    </div>

    <!-- Main Dashboard -->
    <div id="app-container" class="bg-gray-800 rounded-2xl shadow-lg w-full max-w-7xl h-auto overflow-hidden flex flex-col hidden">

        <!-- Header -->
        <div class="p-6 bg-gray-900 flex justify-between items-center rounded-t-2xl">
            <h1 class="text-2xl font-bold text-indigo-500">My Financial Dashboard</h1>
            <div class="flex items-center space-x-4">
                <span id="user-id-display" class="bg-gray-700 text-gray-300 text-xs px-3 py-1 rounded-full truncate max-w-xs">User ID: N/A</span>
                <button id="logout-btn" class="btn-primary px-4 py-2">Logout</button>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="flex-grow flex flex-col p-6 space-y-4">
            <div class="flex space-x-2 border-b-2 border-gray-700">
                <button id="dashboard-tab" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg active">Dashboard</button>
                <button id="stocks-tab" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg">Stocks</button>
                <button id="credits-tab" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg">Credits</button>
                <button id="debts-tab" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg">Debts</button>
                <button id="budget-tab" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg">Budget</button>
            </div>

            <!-- Dashboard View -->
            <div id="dashboard-view" class="tab-content grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Net Worth Card -->
                <div class="card">
                    <h2 class="text-xl font-bold mb-2">Net Worth</h2>
                    <div class="text-3xl font-bold">₹ 0</div>
                </div>
            </div>

            <!-- Stocks View -->
            <div id="stocks-view" class="tab-content hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Stocks</h2>
                    <button id="fetch-zerodha-btn" class="bg-indigo-600 text-white text-sm px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200">
                        <div class="flex items-center space-x-2">
                            <span>Fetch from Zerodha</span>
                        </div>
                    </button>
                </div>
                <div class="overflow-x-auto bg-gray-900 rounded-xl">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Symbol</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Quantity</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Buy Price</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Current Price</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Value</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">P&L</th>
                            </tr>
                        </thead>
                        <tbody id="stocks-table" class="bg-gray-800 divide-y divide-gray-700">
                            <!-- Stock items will be added here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Credits View -->
            <div id="credits-view" class="tab-content hidden">
                <h2 class="text-xl font-bold mb-4">Credits</h2>
                <form id="add-credit-form" class="bg-gray-900 p-6 rounded-xl shadow-inner grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <input type="text" id="credit-person" placeholder="Person Name" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="number" id="credit-amount" placeholder="Amount (₹)" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="number" id="credit-rate" placeholder="Interest Rate (%)" step="0.01" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="number" id="credit-tenure" placeholder="Tenure (months)" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button type="submit" class="bg-indigo-600 text-white font-bold py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200">Add Credit</button>
                </form>
                <div class="overflow-x-auto bg-gray-900 rounded-xl">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Person</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Principal</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Tenure</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Rate (%)</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Interest</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Total</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Date</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="credits-table" class="bg-gray-800 divide-y divide-gray-700">
                            <!-- Credit items will be added here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Debts View -->
            <div id="debts-view" class="tab-content hidden">
                <h2 class="text-xl font-bold mb-4">Debts</h2>
                <form id="add-debt-form" class="bg-gray-900 p-6 rounded-xl shadow-inner grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <input type="text" id="debt-person" placeholder="Person Name" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="number" id="debt-amount" placeholder="Amount (₹)" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="number" id="debt-rate" placeholder="Interest Rate (%)" step="0.01" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="number" id="debt-tenure" placeholder="Tenure (months)" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button type="submit" class="bg-indigo-600 text-white font-bold py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200">Add Debt</button>
                </form>
                <div class="overflow-x-auto bg-gray-900 rounded-xl">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Person</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Principal</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Tenure</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Rate (%)</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Interest</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Total</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Date</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="debts-table" class="bg-gray-800 divide-y divide-gray-700">
                            <!-- Debt items will be added here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Budget View -->
            <div id="budget-view" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Monthly Budget Tracker</h2>
                    <div class="flex items-center space-x-4">
                        <select id="budget-month-filter" class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <!-- Options will be populated by JS -->
                        </select>
                        <select id="budget-year-filter" class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                </div>

                <!-- Budget Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gray-900 p-6 rounded-xl shadow-inner">
                        <h3 class="text-gray-400 text-lg font-medium">Total Inflow</h3>
                        <p id="total-inflow" class="text-3xl font-bold mt-2 text-green-400">₹0</p>
                    </div>
                    <div class="bg-gray-900 p-6 rounded-xl shadow-inner">
                        <h3 class="text-gray-400 text-lg font-medium">Total Outflow</h3>
                        <p id="total-outflow" class="text-3xl font-bold mt-2 text-red-400">₹0</p>
                    </div>
                    <div class="bg-gray-900 p-6 rounded-xl shadow-inner">
                        <h3 class="text-gray-400 text-lg font-medium">Net Balance</h3>
                        <p id="net-balance" class="text-3xl font-bold mt-2 text-blue-400">₹0</p>
                    </div>
                </div>

                <!-- Add Transaction Form -->
                <form id="add-transaction-form" class="bg-gray-900 p-6 rounded-xl shadow-inner grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                    <select id="transaction-type" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Select Type</option>
                        <option value="inflow">Inflow</option>
                        <option value="outflow">Outflow</option>
                    </select>
                    <select id="transaction-category" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Select Category</option>
                        <!-- Options will be populated by JS -->
                    </select>
                    <input type="number" id="transaction-amount" placeholder="Amount (₹)" required class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="text" id="transaction-description" placeholder="Description (optional)" class="bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button type="submit" class="bg-indigo-600 text-white font-bold py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200">Add Transaction</button>
                </form>

                <!-- Budget Categories Overview -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Inflow Categories -->
                    <div class="bg-gray-900 p-6 rounded-xl shadow-inner">
                        <h3 class="text-lg font-bold mb-4 text-green-400">Inflow Categories</h3>
                        <div id="inflow-categories" class="space-y-3">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Outflow Categories -->
                    <div class="bg-gray-900 p-6 rounded-xl shadow-inner">
                        <h3 class="text-lg font-bold mb-4 text-red-400">Outflow Categories</h3>
                        <div id="outflow-categories" class="space-y-3">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Transactions Table -->
                <div class="overflow-x-auto bg-gray-900 rounded-xl">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Date</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Type</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Category</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Amount</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Description</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table" class="bg-gray-800 divide-y divide-gray-700">
                            <!-- Transaction items will be added here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Confirmations -->
    <div id="confirm-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="modal p-6 shadow-lg w-full max-w-sm text-center">
            <h3 class="text-xl font-bold mb-4">Confirm Action</h3>
            <p id="modal-message" class="text-gray-400 mb-6"></p>
            <div class="flex justify-center space-x-4">
                <button id="modal-confirm-btn" class="btn-primary px-4 py-2">Confirm</button>
                <button id="modal-cancel-btn" class="btn-primary px-4 py-2">Cancel</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, writeBatch, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        // TODO: Replace with your actual Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyB-oqOuVoNJWmpW1KAq8eqEXiQtvYfxSdk",
            authDomain: "financialtracker-mani.firebaseapp.com",
            projectId: "financialtracker-mani",
            storageBucket: "financialtracker-mani.firebasestorage.app",
            messagingSenderId: "291386637366",
            appId: "1:291386637366:web:090b26f9652a394cbdec97",
            measurementId: "G-HF9JZC689P"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let userId = null;

        // DOM Elements
        const loginContainer = document.getElementById('login-container');
        const appContainer = document.getElementById('app-container');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const userIdDisplay = document.getElementById('user-id-display');
        const loadingOverlay = document.getElementById('loading-overlay');
        const dashboardTab = document.getElementById('dashboard-tab');
        const stocksTab = document.getElementById('stocks-tab');
        const creditsTab = document.getElementById('credits-tab');
        const debtsTab = document.getElementById('debts-tab');
        const budgetTab = document.getElementById('budget-tab');
        const dashboardView = document.getElementById('dashboard-view');
        const stocksView = document.getElementById('stocks-view');
        const creditsView = document.getElementById('credits-view');
        const debtsView = document.getElementById('debts-view');
        const budgetView = document.getElementById('budget-view');
        const confirmModal = document.getElementById('confirm-modal');
        const modalMessage = document.getElementById('modal-message');

        // Show loading overlay
        function showLoading(show) {
            loadingOverlay.classList.toggle('hidden', !show);
        }

        // Authentication logic
        onAuthStateChanged(auth, async (user) => {
            showLoading(false);
            if (user) {
                userId = user.uid;
                userIdDisplay.textContent = `User ID: ${userId}`;
                loginContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                setupRealtimeListeners();
            } else {
                userId = null;
                userIdDisplay.textContent = 'User ID: N/A';
                loginContainer.classList.remove('hidden');
                appContainer.classList.add('hidden');
            }
        });

        loginBtn.addEventListener('click', async () => {
            showLoading(true);
            try {
                await signInAnonymously(auth);
            } catch (e) {
                alert('Login failed: ' + e.message);
                showLoading(false);
            }
        });

        logoutBtn.addEventListener('click', async () => {
            showLoading(true);
            try {
                await signOut(auth);
            } catch (e) {
                alert('Logout failed: ' + e.message);
            }
            showLoading(false);
        });

        // Modal logic
        let currentModalAction = null;
        function showModal(message, onConfirm) {
            modalMessage.textContent = message;
            confirmModal.classList.remove('hidden');
            currentModalAction = onConfirm;
        }
        // Modal confirm/cancel buttons
        document.getElementById('modal-confirm-btn')?.addEventListener('click', () => {
            confirmModal.classList.add('hidden');
            if (currentModalAction) currentModalAction();
        });
        document.getElementById('modal-cancel-btn')?.addEventListener('click', () => {
            confirmModal.classList.add('hidden');
            currentModalAction = null;
        });

        // Tab navigation
        const tabs = {
            dashboard: { btn: dashboardTab, view: dashboardView },
            stocks: { btn: stocksTab, view: stocksView },
            credits: { btn: creditsTab, view: creditsView },
            debts: { btn: debtsTab, view: debtsView },
            budget: { btn: budgetTab, view: budgetView }
        };
        function switchTab(activeTab) {
            Object.keys(tabs).forEach(tab => {
                tabs[tab].btn.classList.toggle('active', tab === activeTab);
                tabs[tab].view.classList.toggle('hidden', tab !== activeTab);
            });
        }
        Object.keys(tabs).forEach(tabName => {
            tabs[tabName].btn.addEventListener('click', () => switchTab(tabName));
        });
        switchTab('dashboard');

        // Realtime listeners (dummy for now)
        function setupRealtimeListeners() {
            // Example: Listen to user's credits
            // onSnapshot(collection(db, 'credits'), (snapshot) => { ... });
            // You can add listeners for stocks, debts, etc.
        }

        // Dashboard logic (dummy)
        function updateDashboard() {
            dashboardView.innerHTML = `
                <div class="bg-indigo-600 rounded-xl p-6 shadow text-center">
                    <h2 class="text-xl font-bold mb-2">Net Worth</h2>
                    <div class="text-3xl font-bold">₹ 0</div>
                </div>
            `;
        }
        updateDashboard();

        // Zerodha API fetcher
        document.getElementById('fetch-zerodha-btn')?.addEventListener('click', async () => {
            showLoading(true);
            try {
                const res = await fetch('http://localhost:5000/api/portfolio');
                const data = await res.json();
                if (data.status === 'success') {
                    stocksView.innerHTML = `<pre>${JSON.stringify(data.data, null, 2)}</pre>`;
                    switchTab('stocks');
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (e) {
                alert('Failed to fetch Zerodha data: ' + e.message);
            }
            showLoading(false);
        });

        // AI Agent button (placeholder)
        document.getElementById('ai-agent-btn')?.addEventListener('click', async () => {
            alert('AI Agent feature coming soon!');
        });

    </script>
</body>
</html>
