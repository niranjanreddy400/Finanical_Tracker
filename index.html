<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pro Financial Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background: radial-gradient(ellipse at top left, #1a1a2e 60%, #23243a 100%); color: #fff; }
    .tab-button { transition: all .3s ease; background: rgba(255,255,255,0.04); }
    .tab-button.active { border-bottom: 3px solid #e50914; color: #e50914; font-weight: 700; background: rgba(229,9,20,0.08); }
    .card { backdrop-filter: blur(8px); background: rgba(35,36,58,0.85); border-radius: 1rem; padding: 1.5rem; box-shadow: 0 8px 32px rgba(229,9,20,0.15); }
    .fade { transition: opacity .3s ease; }
    .tab-content.hidden { opacity: 0; pointer-events: none; height: 0; overflow: hidden; }
    .tab-content:not(.hidden) { opacity: 1; height: auto; }
    table tbody tr:hover { background: rgba(255,255,255,0.05); }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

  <!-- Toast Container -->
  <div id="toast-container" class="fixed bottom-5 right-5 space-y-2 z-50"></div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 hidden">
    <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-indigo-500"></div>
  </div>

  <!-- Initial Login -->
  <div id="initial-login" class="fixed inset-0 flex items-center justify-center bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 z-50">
    <div class="bg-gray-800 rounded-2xl shadow-lg p-10 flex flex-col items-center max-w-sm w-full">
      <img src="https://cdn-icons-png.flaticon.com/512/2920/2920227.png" class="w-20 h-20 mb-4" />
      <h1 class="text-3xl font-bold text-indigo-500 mb-2">Welcome to Pro Financial Dashboard</h1>
      <p class="text-gray-400 mb-6 text-center">Track your stocks, credits, debts, and budget in one place.</p>
      <button id="start-login-btn" class="btn-primary w-full py-3 px-6 text-lg font-bold">Get Started</button>
    </div>
  </div>

  <!-- Login -->
  <div id="login-container" class="bg-gray-800 p-8 rounded-2xl shadow-lg w-full max-w-sm hidden">
    <h2 class="text-3xl font-bold text-center mb-6 text-indigo-500">Login</h2>
    <button id="login-btn" onclick="onLoginClick()" class="btn-primary w-full py-3 px-6">Sign in Anonymously</button>
  </div>

  <!-- App Container -->
  <div id="app-container" class="bg-gray-800 rounded-2xl shadow-lg w-full max-w-7xl flex flex-col hidden">

    <!-- Header -->
    <div class="p-6 bg-gray-900 flex justify-between items-center rounded-t-2xl">
      <h1 class="text-2xl font-bold text-indigo-500">My Financial Dashboard</h1>
      <div class="flex items-center space-x-4">
        <span id="user-id-display" class="bg-gray-700 text-gray-300 text-xs px-3 py-1 rounded-full">User ID: N/A</span>
        <button id="logout-btn" onclick="onLogoutClick()" class="btn-primary px-4 py-2">Logout</button>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex space-x-2 border-b-2 border-gray-700 px-6 pt-4">
      <button id="dashboard-tab" class="tab-button active px-4 py-2 rounded-t-lg" onclick="switchTab('dashboard')">Dashboard</button>
      <button id="stocks-tab" class="tab-button px-4 py-2 rounded-t-lg" onclick="switchTab('stocks')">Stocks</button>
      <button id="credits-tab" class="tab-button px-4 py-2 rounded-t-lg" onclick="switchTab('credits')">Credits</button>
      <button id="debts-tab" class="tab-button px-4 py-2 rounded-t-lg" onclick="switchTab('debts')">Debts</button>
      <button id="budget-tab" class="tab-button px-4 py-2 rounded-t-lg" onclick="switchTab('budget')">Budget</button>
    </div>

    <!-- Views -->
    <div class="flex-grow flex flex-col p-6 space-y-4">
      <!-- Dashboard -->
      <div id="dashboard-view" class="tab-content grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade">
        <div class="card text-center">
          <h2 class="text-xl font-bold mb-2"><i class="fa-solid fa-wallet mr-2"></i>Net Worth</h2>
          <div id="net-worth-display" class="text-3xl font-bold">₹ 0</div>
          <canvas id="netWorthChart" style="max-width:300px; margin-top:1rem;"></canvas>
        </div>
        <div class="card text-center">
          <h2 class="text-xl font-bold mb-2"><i class="fa-solid fa-chart-line mr-2"></i>Stocks</h2>
          <canvas id="stocksChart" style="max-width:300px;"></canvas>
        </div>
        <div class="card text-center">
          <h2 class="text-xl font-bold mb-2"><i class="fa-solid fa-coins mr-2"></i>Budget</h2>
          <canvas id="budgetPieChart" style="max-width:300px;"></canvas>
        </div>
      </div>

      <!-- Stocks -->
      <div id="stocks-view" class="tab-content hidden fade">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">Stocks</h2>
          <button id="fetch-zerodha-btn" onclick="onFetchZerodhaClick()" class="btn-primary text-sm px-4 py-2">Fetch from Zerodha</button>
        </div>
        <div class="overflow-x-auto bg-gray-900 rounded-xl">
          <table class="min-w-full">
            <thead><tr><th>Symbol</th><th>Qty</th><th>Buy</th><th>Current</th><th>Value</th><th>P&L</th></tr></thead>
            <tbody id="stocks-table" class="divide-y divide-gray-700"></tbody>
          </table>
        </div>
      </div>

      <!-- Credits -->
      <div id="credits-view" class="tab-content hidden fade">
        <h2 class="text-xl font-bold mb-4">Credits</h2>
        <form id="add-credit-form" onsubmit="onAddCreditSubmit(event)" class="grid gap-4 bg-gray-900 p-4 rounded-xl">
          <input id="credit-person" placeholder="Person Name" required class="px-4 py-2 rounded bg-gray-800" />
          <input id="credit-amount" type="number" placeholder="Amount (₹)" required class="px-4 py-2 rounded bg-gray-800" />
          <input id="credit-rate" type="number" step="0.01" placeholder="Rate (%)" required class="px-4 py-2 rounded bg-gray-800" />
          <button class="btn-primary px-4 py-2">Add Credit</button>
        </form>
        <table class="min-w-full mt-4"><tbody id="credits-table"></tbody></table>
      </div>

      <!-- Debts -->
      <div id="debts-view" class="tab-content hidden fade">
        <h2 class="text-xl font-bold mb-4">Debts</h2>
        <form id="add-debt-form" onsubmit="onAddDebtSubmit(event)" class="grid gap-4 bg-gray-900 p-4 rounded-xl">
          <input id="debt-person" placeholder="Person Name" required class="px-4 py-2 rounded bg-gray-800" />
          <input id="debt-amount" type="number" placeholder="Amount (₹)" required class="px-4 py-2 rounded bg-gray-800" />
          <input id="debt-rate" type="number" step="0.01" placeholder="Rate (%)" required class="px-4 py-2 rounded bg-gray-800" />
          <input id="debt-date" type="date" required class="px-4 py-2 rounded bg-gray-800" />
          <button class="btn-primary px-4 py-2">Add Debt</button>
        </form>
        <table class="min-w-full mt-4"><tbody id="debts-table"></tbody></table>
      </div>

      <!-- Budget -->
      <div id="budget-view" class="tab-content hidden fade">
        <h2 class="text-xl font-bold mb-4">Budget Tracker</h2>
        <form id="add-transaction-form" onsubmit="onAddTransactionSubmit(event)" class="grid gap-4 bg-gray-900 p-4 rounded-xl">
          <select id="transaction-type" required><option value="">Type</option><option value="inflow">Inflow</option><option value="outflow">Outflow</option></select>
          <input id="transaction-category" placeholder="Category" required class="px-4 py-2 rounded bg-gray-800" />
          <input id="transaction-amount" type="number" placeholder="Amount (₹)" required class="px-4 py-2 rounded bg-gray-800" />
          <input id="transaction-description" placeholder="Description" class="px-4 py-2 rounded bg-gray-800" />
          <button class="btn-primary px-4 py-2">Add Transaction</button>
        </form>
        <table class="min-w-full mt-4"><tbody id="transactions-table"></tbody></table>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div id="confirm-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 hidden">
    <div class="card text-center max-w-sm">
      <h3 class="text-xl font-bold mb-4">Confirm Action</h3>
      <p id="modal-message" class="text-gray-400 mb-6"></p>
      <div class="flex justify-center space-x-4">
        <button id="modal-confirm-btn" onclick="onModalConfirm()" class="btn-primary px-4 py-2">Confirm</button>
        <button id="modal-cancel-btn" onclick="onModalCancel()" class="btn-primary px-4 py-2">Cancel</button>
      </div>
    </div>
  </div>

  <script type="module" src="./financialTracker.js"></script>
</body>
</html>
